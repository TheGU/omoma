{% load i18n %}
{% spaceless %}
{% if saved %}
    <div id="currenciessaved" class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">
        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>{% trans "Your currencies have been saved." %}</p>
    </div>
{% endif %}
{% if newcreated %}
    <div id="currenciessaved" class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">
        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>{% trans "New currency created." %}</p>
    </div>
{% endif %}
{% if deleted %}
    <div id="currenciessaved" class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;">
        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>{% trans "Currency has been deleted." %}</p>
    </div>
{% endif %}
<form id="currenciesform" action="{% url configurecurrencies %}" method="POST">
    {% csrf_token %}
    {{ formset.management_form }}
    <table>
        <tr>
            <th></th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Symbol" %}</th>
            <th>{% trans "Exchange rate" %}</th>
        </tr>
        {% for form in formset %}
            {{ form.id }}
            <tr>
                <td>
                    {% if not form.instance.is_used %}
                        <span id="deletecurrency{{ form.instance.id }}" class="button deletecurrency">
                            <span class="jquery-icon jquery-icon-4b1c6c-cd0a0a ui-icon-closethick"></span>
                        </span>
                    {% endif %}
                </td>
                <td>{{ form.name }}</td>
                <td>{{ form.symbol }}</td>
                {# TODO Better presentation for this #}
                <td>{{ form.rate }}</td>
            </tr>
        {% endfor %}
    </table>
    <input type="submit" value="{% trans "Save modifications" %}" />
    <button type="button" id="newcurrency">{% trans "Create new currency" %}</button>
</form>
<script>
    $('button#newcurrency').click(function (event) {
        opendialog("newcurrency", gettext("Create new currency"));
        event.preventDefault();
    });
    $('span.deletecurrency').click(function (event) {
        opendialog($(this).attr('id'), gettext("Delete currency"));
        event.preventDefault();

    });
    updateinputelements();
    dialogform('currencies', 'currenciessaved');</script>
{% endspaceless %}
